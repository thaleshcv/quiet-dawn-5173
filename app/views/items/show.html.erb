<%= render "partials/flash_messages" %>

<%= content_for :page_head do %>
	<div class="columns">
		<div class="column is-full-mobile is-half-desktop has-text-centered-mobile">
			<h2 class="title">
				<%= @item.abbreviation %>
				<span class="ml-1 text-muted"><%= @item.name %></span>
				<div class="columns mt-2">
					<div class="column is-narrow">
						<p class="heading">
							<span class="has-text-weight-light">
								Current price
							</span>
							<%= @item.current_price.present? ? number_to_currency(@item.current_price.value) : "Not available" %>
						</p>
					</div>
					<div class="column is-narrow">
						<p class="heading">
							<span class="has-text-weight-light">
								Updated at
							</span>
							<%= @item.current_price.present? ? I18n.l(@item.current_price.date, format: :long) : "Not available" %>
						</p>
					</div>
				</div>
			</h2>
		</div>
		<div class="column is-half-desktop is-full-mobile">
			<nav class="level">
				<div class="level-item mr-1 has-text-right-desktop has-text-centered-mobile">
					<div>
						<p class="heading">Quantity</p>
						<p class="title">
							<%= @investment_totals.quantity %>
						</p>
					</div>
				</div>
				<div class="level-item mr-1 has-text-right-desktop has-text-centered-mobile">
					<div>
						<p class="heading">Invested</p>
						<p class="title">
							<%= number_to_currency(@investment_totals.total_invested) %>
						</p>
					</div>
				</div>
				<div class="level-item mr-1 has-text-right-desktop has-text-centered-mobile">
					<div>
						<p class="heading">Accumulated</p>
						<p class="title">
							<%= number_to_currency(@investment_totals.total_accumulated) %>
							<%= styled_numeric(@investment_totals.difference_in_percent(:total_invested, :total_accumulated)) do |num| %>
								(<%= number_to_percentage(num, precision: 1) %>)
							<% end %>
						</p>
					</div>
				</div>
			</nav>
		</div>
	</div>

	<div class="mt-5 has-text-centered">
		<%= link_to 'Add investment', new_investment_path(item_id: @item), class: "button is-ghost" %>
	</div>
<% end %>

<div class="columns">
	<div class="column is-half-desktop is-full-mobile">
		<h3 class="subtitle">Accumulated value</h3>
	</div>
	<div class="column has-text-right is-half-desktop is-full-mobile">
		<div class="chart-range-options">
			<%= chart_range_option '30 Days',
				accumulated_item_url(@item, range_type: '30d'),
				range: '30d',
				disabled: @accumulated_value_chart.range_type == '30d' %>
			<%= chart_range_option '60 Days',
				accumulated_item_url(@item, range_type: '60d'),
				range: '60d',
				disabled: @accumulated_value_chart.range_type == '60d' %>
			<%= chart_range_option '90 Days',
				accumulated_item_url(@item, range_type: '90d'),
				range: '90d',
				disabled: @accumulated_value_chart.range_type == '90d' %>
		</div>
	</div>
</div>

<div class="block">
	<%= area_chart [
			{ name: "Accumulated", data: @accumulated_value_chart.accumulated_series },
			{ name: "Invested", data: @accumulated_value_chart.invested_series }
		],
		id: "accumulated-value-chart",
		legend: "bottom",
		min: @accumulated_value_chart.minmax_chart_value.first,
		max: @accumulated_value_chart.minmax_chart_value.last,
		curve: false,
		prefix: "$",
		thousands: ",",
		decimals: "." %>
</div>

<div class="block">
	<h3 class="subtitle">Investments</h3>
</div>

<div class="columns is-multiline">
	<%= render partial: "items/investment", collection: @investments %>
</div>

<% if @investments.empty? %>
	<div class="alert alert-info">
		<strong>Info!</strong>
		You have no investments on this item.
	</div>
<% end %>
</div>
